<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Calculadora LCOE Avançada</title>
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css">
</head>
<body>
  <div class="container mt-5">
    <h1>Calculadora LCOE Avançada</h1>
    <form id="lcoeForm">
      <div class="mb-3">
        <label for="investmentInput" class="form-label">Investimento Inicial (CAPEX):</label>
        <input type="text" class="form-control" id="investmentInput" required>
      </div>
      <div class="mb-3">
        <label for="operatingExpensesInput" class="form-label">Despesas Operacionais no Ano 1 (OPEX):</label>
        <input type="text" class="form-control" id="operatingExpensesInput" required>
      </div>
      <div class="mb-3">
        <label for="energyGenerationInput" class="form-label">Geração de Energia Anual (kWh):</label>
        <input type="text" class="form-control" id="energyGenerationInput" required>
      </div>
      <div class="mb-3">
        <label for="discountRateInput" class="form-label">Taxa de Desconto (%):</label>
        <input type="text" class="form-control" id="discountRateInput" required>
      </div>
      <div class="mb-3">
        <label for="projectLifetimeInput" class="form-label">Vida Útil do Projeto (anos):</label>
        <input type="text" class="form-control" id="projectLifetimeInput" required>
      </div>
      <button type="submit" class="btn btn-primary">Calcular LCOE</button>
    </form>
    <div id="result" class="mt-3"></div>
  </div>

  <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/inputmask/dist/inputmask.min.js"></script>

  <script>
    $(document).ready(function() {
      // Aplica máscaras aos campos
      Inputmask({
        alias: "currency",
        prefix: "R$ ",
        groupSeparator: ".",
        radixPoint: ",",
        autoGroup: true,
        digits: 2,
        digitsOptional: false,
        clearMaskOnLostFocus: false
      }).mask("#investmentInput, #operatingExpensesInput");

      Inputmask({
        alias: "decimal",
        radixPoint: ",",
        groupSeparator: ".",
        digits: 0,
        autoGroup: true,
        clearMaskOnLostFocus: false
      }).mask("#energyGenerationInput, #projectLifetimeInput");

      Inputmask({
        alias: "percentage",
        suffix: " %",
        digits: 2,
        radixPoint: ",",
        clearMaskOnLostFocus: false
      }).mask("#discountRateInput");

      // Calcula o LCOE
      $('#lcoeForm').on('submit', function(event) {
        event.preventDefault();

        // Obtém os valores de entrada (remove formatações das máscaras)
        const investment = parseFloat(Inputmask.unmask($('#investmentInput').val(), { alias: "currency" }));
        const opex = parseFloat(Inputmask.unmask($('#operatingExpensesInput').val(), { alias: "currency" }));
        const energyGeneration = parseFloat(Inputmask.unmask($('#energyGenerationInput').val(), { alias: "decimal" }));
        const discountRate = parseFloat(Inputmask.unmask($('#discountRateInput').val(), { alias: "percentage" })) / 100;
        const projectLifetime = parseInt(Inputmask.unmask($('#projectLifetimeInput').val(), { alias: "decimal" }));

        // Calcula o numerador e o denominador do LCOE
        let numerator = investment;
        let denominator = 0;

        for (let t = 1; t <= projectLifetime; t++) {
          numerator += opex / Math.pow(1 + discountRate, t);
          denominator += energyGeneration / Math.pow(1 + discountRate, t);
        }

        // Calcula o LCOE
        const lcoe = numerator / denominator;

        // Exibe o resultado formatado
        $('#result').html('<h3>O LCOE é: R$ ' + lcoe.toFixed(4).replace('.', ',') + ' por kWh</h3>');
      });
    });
  </script>
</body>
</html>
